<?xml version="1.0" encoding="UTF-8" ?>
<h:div id="history-div" 
	xmlns:h="http://www.w3.org/1999/xhtml" 
	xmlns:t="http://www.tei-c.org/ns/1.0" 
	xmlns:xf="http://www.w3.org/2002/xforms"
	xmlns:xi="http://www.w3.org/2001/XInclude" 
	xmlns:ev="http://www.w3.org/2001/xml-events" 
	xmlns:m="http://www.music-encoding.org/ns/mei"
	xmlns:dcm="http://www.kb.dk/dcm">
	
	<h:div class="inputdiv">
		
		<xf:group ref="instance('data-instance')/m:meiHead/m:workDesc/m:work/m:history">
			<h:fieldset>
				<h:legend>Creation</h:legend>
				<h:div class="vertical_spacer"/>
				<dcm:date-editor ref="m:creation/m:date" style="display:inline;">
					<xf:label class="fixed_width_mediumlong">Date of composition <h:a class="help">?<h:span class="comment">Date or time span 
						of composition</h:span></h:a></xf:label>
				</dcm:date-editor>
				<xf:input ref="m:creation/m:geogName" class="long">
					<xf:label class="fixed_width_mediumlong">Place of composition </xf:label>
				</xf:input>
				<!--<dcm:attribute-editor ref="m:creation/m:geogName[instance('conf')/dcm:attr='true']"/>-->
				<xf:textarea ref="m:p" class="notes">
					<xf:label class="blocklabel">Creation note <h:a class="help">?<h:span class="comment">Text
						explaining details and circumstances concerning the work's genesis and history</h:span></h:a>
						<h:a class="help_plain"><h:img src="http:/editor/images/html_markup.gif" alt="HTML markup allowed"
						/><h:span class="comment">HTML markup and special characters allowed</h:span></h:a>
					</xf:label>
				</xf:textarea>
				<!--<dcm:attribute-editor ref="m:p[instance('conf')/dcm:attr='true']"/>-->
			</h:fieldset>
			<h:fieldset>
				<h:legend>Time line <h:a class="help">?<h:span class="comment">A list of events related to the work. The list
					may contain all kinds of events, whether related the compositional process, 
					the work's transmission, its reception or other aspects of its history</h:span></h:a>
					<!--<dcm:attribute-editor ref="m:eventList[@type='history'][instance('conf')/dcm:attr='true']"/>-->
				</h:legend>
				<xf:repeat nodeset="m:eventList[@type='history']/m:event" id="repeat-work-history">
					<h:fieldset>
						<h:legend>Event <dcm:element-buttons 
							triggers="all" 
							nodeset="m:event" 
							index="repeat-work-history"
							origin="instance('empty-instance')/m:meiHead/m:workDesc/m:work/m:history/m:eventList[@type='history']/m:event"/>
							<!--<dcm:attribute-editor ref=".[instance('conf')/dcm:attr='true']"/>-->
							<h:br clear="all"/>
						</h:legend>
						<xf:group ref="m:date">
							<xf:label class="fixed_width">Date <h:a class="help">?<h:span class="comment">Date 
								or date span of the event</h:span></h:a></xf:label>
							<dcm:date-editor ref="."/>
						</xf:group>
						<xf:input ref="m:title" class="long">
							<xf:label class="fixed_width">Description <h:a class="help">?<h:span class="comment">A description of the 
								event, e.g. "Third movement finished" or "Arranged for piano by NN"</h:span></h:a></xf:label>
						</xf:input>
						<!--<dcm:attribute-editor ref="m:title[instance('conf')/dcm:attr='true']"/>-->
					</h:fieldset>					
				</xf:repeat>
			</h:fieldset>
			<dcm:performance-list ref="m:eventList[@type='performances']"/>		
		</xf:group>
		
		<xf:group ref="instance('data-instance')/m:meiHead/m:workDesc/m:work">			
			<!-- list performances for versions with a title only (i.e. expressions marked as not being the only one) -->
			<xf:repeat nodeset="m:expressionList/m:expression[m:titleStmt/m:title[normalize-space(.)]]" id="repeat-expression-performances">
				<dcm:performance-list ref="m:history/m:eventList[@type='performances']"/>		
			</xf:repeat>
		</xf:group>
		
	</h:div>
	
	<h:br clear="all"/>
	
</h:div>
