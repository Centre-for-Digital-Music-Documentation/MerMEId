<?xml version="1.0" encoding="UTF-8"?>
<h:html xmlns:h="http://www.w3.org/1999/xhtml" 
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xxi="http://orbeon.org/oxf/xml/xinclude"
    xmlns:xf="http://www.w3.org/2002/xforms" 
    xmlns:xxf="http://orbeon.org/oxf/xml/xforms"
    xmlns:oxf="http://www.orbeon.com/oxf/processors"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
    xmlns:ev="http://www.w3.org/2001/xml-events" 
    xmlns:xl="http://www.w3.org/1999/xlink"
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    xmlns:m="http://www.music-encoding.org/ns/mei"
    xmlns:t="http://www.tei-c.org/ns/1.0" 
    xmlns:dcm="http://www.kb.dk/dcm">
    
    <!--
        Source data editor 
        Danish Centre for Music Publication (DCM) 
        Axel Teich Geertinger, 2012
        atge@kb.dk
    -->
    
    <h:head>
        
        <h:title id="PageTitle">MerMEId - Editing source metadata</h:title>
        
        <h:meta http-equiv="Content-Type" content="application/xhtml+xml"/>
        
        <h:script type="text/javascript" src="http:/editor/js/editor.js"/>
        
        <h:style type="text/css" media="all"> 
            @import "/editor/style/tab_style.css"; 
            @import "/editor/style/xform_style.css";
            @import "/editor/style/model_editor_style.css";
        </h:style>
        
        <xf:model>
            
            <xf:instance id="data-instance" xmlns="http://www.music-encoding.org/ns/mei">
                <mei/>
            </xf:instance>
            
            <xf:instance id="empty-instance" xmlns="http://www.music-encoding.org/ns/mei">
                <mei/>
            </xf:instance>
            
            <xf:instance id="temp">
                <temp>
                    <id/>
                    <counter/>
                    <changed>false</changed>
                    <change_marker>*</change_marker>
                    <etc>...</etc>
                    <target_uri/>
                </temp>
            </xf:instance> 
            
            <xf:bind nodeset="instance('temp')">
                <xf:bind id="counter-bind" nodeset="counter" type="xf:integer" name="counter"/>
            </xf:bind>               
            
            <xf:instance id="parameters" xmlns="http://www.kb.dk/dcm">
                <xi:include href="mermeid_configuration.xml" parse="xml"/>
            </xf:instance>
            
            <!-- submissions - loading and saving data -->            
            
            <xf:submission id="load-data-submission" 
                method="get" 
                serialization="none" 
                validate="false"
                resource="{instance('parameters')/dcm:crud_home}{instance('parameters')/dcm:xml_file}"
                replace="instance" instance="data-instance"/>
            
            <xf:submission id="load-empty-submission"
                method="get" 
                serialization="none" 
                validate="false"
                resource="{instance('temp')/target_uri}"
                replace="instance" instance="empty-instance"/>
            
            <xf:submission id="save-to-file"
                ref="instance('data-instance')"
                validate="false"
                relevant="false"
                xxf:calculate="false"
                resource="{instance('parameters')/dcm:crud_home}{instance('parameters')/dcm:xml_file}" 
                method="put"
                replace="instance">
            </xf:submission>
            
            <!-- "onload" xforms actions -->
            <xf:action ev:event="xforms-model-construct-done">
                <!-- store requested ID -->
                <xf:setvalue ref="instance('temp')/id" value="xxf:get-request-parameter('id')"/>
                <!-- store XML data file name -->
                <xf:setvalue ref="instance('parameters')/dcm:xml_file" value="xxf:get-request-parameter('doc')"/>
                <!-- load XML data -->
                <xf:send submission="load-data-submission"/>
                <!-- load empty model XML data -->
                <xf:setvalue ref="instance('temp')/target_uri" value="concat(instance('parameters')/dcm:form_home,'model/empty_doc.xml')"/>
                <xf:send submission="load-empty-submission"/>
            </xf:action>
            
            <xf:action ev:event="xforms-submit-done">
                <!-- set instance state to unchanged on saving -->
                <xf:setvalue ref="instance('temp')/changed" value="'false'"/>
            </xf:action>
            
            <xf:action ev:event="xforms-submit-error">
                <xxf:variable name="code" select="event('response-status-code')"/>
                <xf:action>
                    <xf:message>An error occurred (<xf:output value="$code"/>)</xf:message>
                </xf:action>
            </xf:action>
            
        </xf:model>
        
        <!-- XBL components -->
        <xi:include href="includes/element_buttons.xbl" parse="xml"/>
        <xi:include href="includes/element_buttons_typed.xbl" parse="xml"/>
        <xi:include href="includes/dropdown_month_date.xbl" parse="xml"/>
        <xi:include href="includes/date_editor.xbl" parse="xml"/>
        <xi:include href="includes/relator.xbl" parse="xml"/>
        <xi:include href="includes/item.xbl" parse="xml"/>
        <xi:include href="includes/id.xbl" parse="xml"/>
        <xi:include href="includes/attribute_editor.xbl" parse="xml"/>
    </h:head>
    
    <h:body class="source">
        
        <xf:group id="form-group">
            
            <xi:include href="edit-form-event-handlers.xml" parse="xml"/>
            
            <h:div class="inputdiv">
                
                <h:div style="float:right">
                    <xf:submit submission="save-to-file">
                        <xf:label>Save</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xxf:variable name="uri" select="concat(instance('parameters')/dcm:edit-sources,instance('parameters')/dcm:xml_file)"/>
                            <xf:load resource="{$uri}" show="replace"/>
                        </xf:action>
                    </xf:submit>
                    <xf:trigger>
                        <xf:label>Cancel</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xxf:variable name="uri" select="concat(instance('parameters')/dcm:edit-sources,instance('parameters')/dcm:xml_file)"/>
                            <xf:load resource="{$uri}" show="replace"/>
                        </xf:action>
                    </xf:trigger>
                </h:div>
                
                
                <xf:group ref="instance('data-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source[@xml:id=instance('temp')/id]">
                    <h:h3>
                        <xf:output value="m:titleStmt/m:title"/>
                        <xf:group ref=".[normalize-space(m:titleStmt/m:title)='']"> [No description] </xf:group>
                        <dcm:id ref="."/>
                        <dcm:attribute-editor ref="."/>
                    </h:h3>                
                    
                    <h:fieldset>
                        <h:legend>Source 
                            <h:a class="help">?<h:span class="comment">A source corresponds to the FRBR "manifestation" level. At this level, therefore, 
                                only information common to all copies of this source should be entered. <h:br/>
                                Information about individual copies (including their location) should be given at "Item" level below.</h:span></h:a>
                        </h:legend>
                        <h:div class="vertical_spacer"> </h:div>
                        
                        <xf:input ref="m:titleStmt/m:title" class="maxlong">
                            <xf:label>Short description or title <h:a class="help">?<h:span class="comment">A heading identifying the source, e.g. "Printed score, first
                                edition", "Autograph score, draft" or "Source A"</h:span></h:a>
                            </xf:label>
                        </xf:input>
                        
                        <!-- Point to relevant version if more than one available -->
                        <xf:group ref=".[count(instance('data-instance')/m:meiHead/m:workDesc/m:work/m:expressionList/m:expression)&gt;1]">
                            <xf:select1 ref="m:relationList/m:relation[@rel='isEmbodimentOf'][1]" xxf:refresh-items="true" id="cast-select">
                                <xf:label class="fixed_width">Represents: 
                                    <h:a class="help">?<h:span class="comment">Indicates which version of the work 
                                        is embodied by the source</h:span></h:a>
                                </xf:label>
                                <xf:item>
                                    <xf:label>- Please select -</xf:label>
                                    <xf:value/>
                                </xf:item>
                                <xf:itemset nodeset="instance('data-instance')/m:meiHead/m:workDesc/m:work/m:expressionList/m:expression">
                                    <xf:label><xf:output value="m:titleStmt/m:title"/> (ID: <xf:output value="@xml:id"/>)</xf:label>
                                    <xf:value ref="@xml:id"></xf:value>
                                </xf:itemset>
                            </xf:select1>	
                        </xf:group>
                        
                        <!-- Source classification -->
                        <h:fieldset>
                            <h:legend>Classification</h:legend>
                            <xf:repeat nodeset="m:classification/m:termList">
                                <xf:select1 ref="m:term[@classcode='DcmContentClass']">
                                    <xf:label class="fixed_width">Content</xf:label>
                                    <xf:item>
                                        <xf:value/>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>music</xf:value>
                                        <xf:label>Music</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>text</xf:value>
                                        <xf:label>Text</xf:label>
                                    </xf:item>
                                </xf:select1>
                                <h:br clear="both"/>
                                <xf:select1 ref="m:term[@classcode='DcmPresentationClass']">
                                    <xf:label class="fixed_width">Presentation <h:a class="help">?<h:span class="comment">Describes
                                        the source's basic mode of production (manuscript or print). <br/> "Print, specific copy" refers to a 
                                        specific copy of a printed source, e.g. the composer's own copy.</h:span></h:a></xf:label>
                                    <xf:item>
                                        <xf:value/>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>manuscript</xf:value>
                                        <xf:label>Manuscript</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>print</xf:value>
                                        <xf:label>Print</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>print, specific copy</xf:value>
                                        <xf:label>Print, specific copy</xf:label>
                                    </xf:item>
                                </xf:select1>
                                <h:br clear="both"/>
                                <xf:select1 ref="m:term[@classcode='DcmAuthorityClass']">
                                    <xf:label class="fixed_width">Authority <h:a class="help">?<h:span class="comment">For 
                                        use with manuscript sources. Describes the composer's degree of involvement
                                        in the production of the source. Thus, an arranger's
                                        own manuscript would <u>not</u> be classified an autograph.</h:span></h:a>
                                    </xf:label>
                                    <xf:item>
                                        <xf:value></xf:value>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>autograph</xf:value>
                                        <xf:label>Autograph</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>doubtful autograph</xf:value>
                                        <xf:label>Doubtful autograph</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>partly autograph</xf:value>
                                        <xf:label>Partly autograph</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>copy</xf:value>
                                        <xf:label>Copy</xf:label>
                                    </xf:item>
                                </xf:select1>
                                <h:br clear="both"/>                        
                                <xf:select1 ref="m:term[@classcode='DcmScoringClass']">
                                    <xf:label class="fixed_width">Scoring</xf:label>
                                    <xf:item>
                                        <xf:value></xf:value>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>score</xf:value>
                                        <xf:label>Score</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>short score</xf:value>
                                        <xf:label>Short score</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>vocal score</xf:value>
                                        <xf:label>Vocal score</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>piano score</xf:value>
                                        <xf:label>Piano score</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>parts</xf:value>
                                        <xf:label>Parts</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>score and parts</xf:value>
                                        <xf:label>Score and parts</xf:label>
                                    </xf:item>
                                </xf:select1>
                                <h:br clear="both"/>
                                <xf:select1 ref="m:term[@classcode='DcmStateClass']">
                                    <xf:label class="fixed_width">State</xf:label>
                                    <xf:item>
                                        <xf:value></xf:value>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>sketch</xf:value>
                                        <xf:label>Sketch</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>draft</xf:value>
                                        <xf:label>Draft</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>fair copy</xf:value>
                                        <xf:label>Fair copy</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>printer's copy</xf:value>
                                        <xf:label>Printer's copy</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>first edition</xf:value>
                                        <xf:label>First edition</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>later edition</xf:value>
                                        <xf:label>Later edition</xf:label>
                                    </xf:item>
                                </xf:select1>
                                <h:br clear="both"/>
                                <xf:select1 ref="m:term[@classcode='DcmCompletenessClass']">
                                    <xf:label class="fixed_width">Completeness <h:a class="help">?<h:span class="comment">Describes 
                                        the completeness of the source: "Complete" indicates that this source is complete (this would also be true
                                        with a single solo violin part from an orchestral work, if it is not the remainder of an originally larger 
                                        set of parts).<br/>
                                        "Incomplete" indicates that one or more parts are missing from a set of parts.<br/>
                                        "Excerpt" designates a section of a work, published or copied for stand-alone performance 
                                        (like "Hanedansen" from Nielsen's "Maskarade").<br/>
                                        "Fragment(s)" indicates that portions of the music are missing, e.g. a fragmentary sketch or a source 
                                        from which pages are lost. 
                                    </h:span></h:a>
                                    </xf:label>
                                    <xf:item>
                                        <xf:value></xf:value>
                                        <xf:label> </xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>complete</xf:value>
                                        <xf:label>Complete</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>incomplete</xf:value>
                                        <xf:label>Incomplete</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>excerpt</xf:value>
                                        <xf:label>Excerpt</xf:label>
                                    </xf:item>
                                    <xf:item>
                                        <xf:value>fragment</xf:value>
                                        <xf:label>Fragment(s)</xf:label>
                                    </xf:item>
                                </xf:select1>
                            </xf:repeat>
                        </h:fieldset>
                        <!-- End source classification -->
                        
                        <xf:group ref="m:titleStmt/m:respStmt" id="repeat-source-respstmt">
                            <h:fieldset>
                                <h:legend>Contributors <h:a class="help">?<h:span class="comment">Lists persons other than the composer or a scribe, 
                                    contributing to the intellectual contents of this source, e.g. an arranger or editor; 
                                    the composer is usually specified under "Identification" and need not be specified here.
                                    Scribes are identified below under "List of hands".</h:span></h:a></h:legend>
                                <xf:repeat nodeset="m:persName" id="repeat-source-respstmt-person">
                                    <dcm:relator ref="."/>
                                    <dcm:element-buttons 
                                        triggers="add delete" 
                                        nodeset="m:persName" 
                                        index="repeat-source-respstmt-person"
                                        origin="instance('empty-instance')/m:meiHead/m:workDesc/m:work/m:titleStmt/m:respStmt/m:persName[1]"/>
                                    <h:br/>
                                </xf:repeat>
                            </h:fieldset>
                        </xf:group>
                        <xf:group ref="m:notesStmt">
                            <h:fieldset>
                                <h:legend>General source description  <h:a class="help">?<h:span class="comment">Text 
                                    describing or introducing to the source, its history, its significance etc.<br/>
                                    Information on the source's physical appearance and condition should be given in the 
                                    "physical description" area below.
                                </h:span></h:a> 
                                    <h:a class="help_plain"><h:img src="http:/editor/images/html_markup.gif" alt="HTML markup allowed"/><h:span class="comment">HTML markup and special characters allowed</h:span></h:a></h:legend>
                                <xf:textarea ref="m:annot[@type='source_description']">
                                </xf:textarea>
                                <xf:group ref="m:annot[@type='links']">
                                    <h:span class="blocklabel">External source descriptions <h:a class="help">?<h:span class="comment">Links to external resources (texts) about 
                                        this particular source.</h:span></h:a>
                                    </h:span>
                                    <xf:repeat nodeset="m:ptr" id="source-notesstmt-annot-repeat-extptr">
                                        <h:div>
                                            <xf:input ref="@target" class="long">
                                                <xf:label>URI <h:a class="help">?<h:span class="comment">Link to the
                                                    resource, e.g. "http://example.com/source_description.pdf"</h:span></h:a>
                                                </xf:label>
                                            </xf:input>
                                            <xf:input ref="@xl:title">
                                                <xf:label>Label <h:a class="help">?<h:span class="comment">A short, 
                                                    descriptive text which may serve
                                                    as the link text, e.g. "The Carl Nielsen Edition's source description"</h:span></h:a></xf:label>
                                            </xf:input>
                                            <dcm:element-buttons 
                                                triggers="all" 
                                                nodeset="m:ptr" 
                                                index="source-notesstmt-annot-repeat-extptr"
                                                origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:notesStmt/m:annot[@type='links']/m:ptr"/>
                                            <!--<dcm:attribute-editor ref=".[instance('conf')/dcm:attr='true']"/>-->
                                        </h:div>
                                    </xf:repeat>
                                </xf:group>
                            </h:fieldset>
                        </xf:group>
                        
                        <xf:group ref="m:physDesc">
                            <h:fieldset>
                                <h:legend>Title page 
                                    <h:a class="help">?<h:span class="comment">Transcription of the source's title page. Multiple title pages
                                        may be added if necessary</h:span></h:a>
                                    <h:a class="help_plain"><h:img src="http:/editor/images/html_markup.gif" alt="HTML markup allowed"/><h:span class="comment">HTML markup and special characters allowed</h:span></h:a>
                                </h:legend>
                                <xf:repeat nodeset="m:titlePage" id="physdesc-titlepage">
                                    <xf:input ref="@label">
                                        <xf:label>Label 
                                            <h:a class="help">?<h:span class="comment">Optional label overriding the default "Title page" label, 
                                                e.g. "Secondary title page" or "title page after first fly leaf". 
                                                Especially, a label should be given to if more than one title page is quoted.</h:span></h:a>
                                        </xf:label>
                                    </xf:input>
                                    <dcm:element-buttons-typed 
                                        triggers="all" 
                                        nodeset="m:titlePage" 
                                        index="physdesc-titlepage"
                                        origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:titlePage"/>
                                    <h:br/>
                                    <xf:textarea ref="m:p" class="mediumheight"/>
                                    <h:hr/> 
                                </xf:repeat>
                            </h:fieldset>
                            
                            <h:fieldset>
                                <h:legend>Physical description 
                                    <h:a class="help">?<h:span class="comment">Describes features shared by all copies of this source. <h:br/>
                                        For details on a specific item (a specific copy, or a manuscript), use the "Items" section below.</h:span></h:a>
                                </h:legend>
                                <xf:repeat nodeset="m:extent" id="physdesc-extent">
                                    <h:div>
                                        <h:span class="fixed_width">Extent:</h:span>
                                        <xf:input ref=".">
                                            <xf:label>Value <h:a class="help">?<h:span class="comment">The number of pages or folios, e.g. "48", "12 + 236", "XII + 36"
                                                + VIII"</h:span></h:a></xf:label>
                                        </xf:input>
                                        <xf:input ref="@unit">
                                            <xf:label>Unit <h:a class="help">?<h:span class="comment">Usually "pages" or "folios"</h:span></h:a></xf:label>
                                        </xf:input>
                                        <dcm:element-buttons 
                                            triggers="delete" 
                                            nodeset="m:extent" 
                                            index="physdesc-extent"
                                            origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:extent"/>
                                    </h:div>
                                </xf:repeat>
                                <xf:repeat nodeset="m:dimensions" id="physdesc-dimensions">
                                    <h:div>
                                        <h:span class="fixed_width">Dimensions:</h:span>
                                        <xf:input ref=".">
                                            <xf:label>Value <h:a class="help">?<h:span class="comment">Numbers describing the physical dimensions of the source given as height x width, e.g.
                                                "23.5x34"</h:span></h:a></xf:label>
                                        </xf:input>
                                        <xf:input ref="@unit">
                                            <xf:label>Unit <h:a class="help">?<h:span class="comment">Unit of measurement, usually "cm"</h:span></h:a></xf:label>
                                        </xf:input>
                                        <dcm:element-buttons 
                                            triggers="delete" 
                                            nodeset="m:dimensions" 
                                            index="physdesc-dimensions"
                                            origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:dimensions"/>
                                    </h:div>
                                </xf:repeat>
                                <xf:textarea ref="m:physMedium" class="mediumheight">
                                    <xf:label class="blocklabel">Physical medium <h:a class="help">?<h:span class="comment">Description of 
                                        paper, number of staves on page, printing technique etc.
                                    </h:span></h:a></xf:label>
                                </xf:textarea>
                            </h:fieldset>
                        </xf:group>
                        
                        <h:fieldset>
                            <h:legend>Publication or creation 
                                <h:a class="help">?<h:span class="comment">If the source is a manuscript, date and place of 
                                    its creation may be entered here.<h:br/>
                                    Otherwise enter publication data.
                                </h:span></h:a></h:legend>
                            <xf:repeat nodeset="m:pubStmt" id="repeat-source-publication">
                                <h:div>
                                    <xf:input ref="m:respStmt/m:corpName" class="mediumlong">
                                        <xf:label class="fixed_width">Publisher </xf:label>
                                    </xf:input>
                                </h:div>
                                <h:div>
                                    <xf:input ref="m:geogName" class="mediumlong">
                                        <xf:label class="fixed_width">Place </xf:label>
                                    </xf:input>
                                </h:div>
                                <dcm:date-editor ref="m:date">
                                    <xf:label class="fixed_width">Date 
                                        <h:a class="help">?<h:span class="comment">This field may be used for manuscript datings also.</h:span></h:a>
                                    </xf:label>
                                </dcm:date-editor>
                                <h:div>
                                    <xf:input ref="m:identifier[@type='plate_no']" class="mediumlong">
                                        <xf:label class="fixed_width">Plate no. </xf:label>
                                    </xf:input>
                                    <dcm:element-buttons 
                                        triggers="delete" 
                                        nodeset="m:pubstmt" 
                                        index="repeat-source-publication"
                                        origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:pubStmt"/>
                                </h:div>
                                <xf:group ref="m:identifier[@analog='RISM']">
                                    <xf:input ref="." class="mediumlong">
                                        <xf:label class="fixed_width">RISM no. <h:a class="help">?<h:span class="comment">Use with  
                                            prints only. With manuscripts, the RISM identifier should be given as part of a 
                                            specific item's location information (below).</h:span></h:a></xf:label>
                                    </xf:input>
                                    <h:br clear="all"/>
                                </xf:group>
                            </xf:repeat>
                        </h:fieldset>
                        
                        <h:fieldset class="items">
                            <h:legend class="items">Items
                                <h:a class="help">?<h:span class="comment">A list of individual copies of the source. 
                                    Manuscript sources will only have one such item.<h:br/>
                                    If the item consists of several components with different physical appearance, 
                                    the distinct features of each component may be specified using the item's "Components" section.<h:br/>
                                </h:span></h:a></h:legend>
                            <xf:repeat nodeset="m:itemList/m:item" id="repeat-item">
                                <h:fieldset>
                                    <h:legend>Item <dcm:id/> 
                                        <dcm:element-buttons 
                                            triggers="all" 
                                            nodeset="m:item" 
                                            index="repeat-item"
                                            origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:itemList/m:item[1]"/>
                                    </h:legend>
                                    <dcm:item ref="."/>
                                    <h:fieldset class="item-components">
                                        <h:legend class="item-components">Components <h:a class="help">?<h:span class="comment">Descriptions of the individual parts that 
                                            constitute a composite source</h:span></h:a></h:legend>
                                        <xf:repeat nodeset="m:componentGrp/m:item" id="repeat-item-component">
                                            <h:fieldset>
                                                <h:legend>Component <dcm:id/> 
                                                    <dcm:element-buttons 
                                                        triggers="all" 
                                                        nodeset="m:item" 
                                                        index="repeat-item-component"
                                                        origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:itemList/m:item[1]/m:componentGrp/m:item[1]"/>
                                                </h:legend>
                                                <dcm:item ref="."/>
                                            </h:fieldset>
                                        </xf:repeat>
                                    </h:fieldset>
                                </h:fieldset>
                            </xf:repeat>
                        </h:fieldset>
                    </h:fieldset>
                    
                </xf:group>
                
            </h:div>
            
        </xf:group>
        <h:br clear="all"/>
        
        <xi:include href="edit-form-footer.xml" parse="xml"/>
    </h:body>
</h:html>
