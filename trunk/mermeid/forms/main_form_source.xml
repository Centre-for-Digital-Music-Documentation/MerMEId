<?xml version="1.0" encoding="UTF-8" ?>
<h:div id="source-div" 
  xmlns:xi="http://www.w3.org/2001/XInclude" 
  xmlns:h="http://www.w3.org/1999/xhtml" 
  xmlns:xf="http://www.w3.org/2002/xforms"
  xmlns:xxf="http://orbeon.org/oxf/xml/xforms" 
  xmlns:ev="http://www.w3.org/2001/xml-events" 
  xmlns:m="http://www.music-encoding.org/ns/mei"
  xmlns:dcm="http://www.kb.dk/dcm">
  
  <h:div class="inputdiv">
    
  <h:fieldset>
    <h:legend>Sources</h:legend>
    <h:br/>
    <h:table class="element_list" cellspacing="0" cellpadding="0" border="0">
      <xf:repeat nodeset="instance('data-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source" id="repeat-sources">
        <h:tr>
          <h:td class="number_cell">
            <xf:output value="position()"/>&#160;
          </h:td>
          <h:td>&#160;  
            <xf:output value="m:titleStmt/m:title"/>
            <xf:group ref=".[normalize-space(m:titleStmt/m:title)='']"> [No description] </xf:group>
          </h:td>
          <h:td>
            <dcm:id ref="."/>
            <xf:group ref=".[instance('temp')/file_exists='true']">
              <xf:trigger>
                <xf:label><h:img src="http:/editor/images/edit.gif" title="Open the source editor"/> Edit</xf:label>
                <xf:action ev:event="DOMActivate">
                  <xxf:variable name="uri" 
                    select="concat(instance('parameters')/dcm:orbeon_dir,'?uri=',instance('parameters')/dcm:form_home,'source_editor.xml&amp;doc=',instance('parameters')/dcm:xml_file,'&amp;id=',@xml:id)"/>
                  <xf:action if="instance('temp')/changed='true'">
                    <xf:setvalue ref="instance('temp')/target_uri" value="$uri"/>
                    <xxf:show dialog="exit-warning-dialog"/>
                  </xf:action>	
                  <xf:action if="instance('temp')/changed='false'">
                    <xf:load resource="{$uri}" show="replace"/>
                  </xf:action>
                </xf:action>
              </xf:trigger>
            </xf:group>
            <xf:group ref=".[instance('temp')/file_exists!='true']">
              <h:small>File must be saved before sources can be edited</h:small>
            </xf:group>
          </h:td>
          <h:td class="buttons_cell"><dcm:element-buttons triggers="all" nodeset="m:source" index="repeat-sources" 
            origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source"/></h:td>
        </h:tr>
      </xf:repeat>
    </h:table>
  </h:fieldset>
  
  </h:div>
  <h:br clear="all"/>
</h:div>
