<?xml version="1.0" encoding="UTF-8" ?>
<h:fieldset xmlns:m="http://www.music-encoding.org/ns/mei" 
	xmlns:h="http://www.w3.org/1999/xhtml" 
	xmlns:xl="http://www.w3.org/1999/xlink"
	xmlns:xf="http://www.w3.org/2002/xforms" 
	xmlns:xxf="http://orbeon.org/oxf/xml/xforms" 
	xmlns:ev="http://www.w3.org/2001/xml-events" 
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:dcm="http://www.kb.dk/dcm">
	
	<h:legend>Source <dcm:id/> 
		<h:a class="help">?<h:span class="comment">A source corresponds to the FRBR "manifestation" level. At this level, therefore, 
		only information common to all copies of this source should be entered. <h:br/>
		Information about individual copies (including their location) should be given at "Item" level below.</h:span></h:a>
		<dcm:element-buttons triggers="all" nodeset="m:source" index="repeat-source" 
			origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source"/>
	</h:legend>
	
	<xf:input ref="m:titleStmt/m:title" class="long">
		<xf:label>Short description <h:a class="help">?<h:span class="comment">A heading identifying the source, e.g. "Printed score, first
			edition", "Printed part, John Fiddler's copy" or "Part, autograph, draft"</h:span></h:a>
		</xf:label>
	</xf:input>
	
	<xf:group ref=".[count(instance('data-instance')/m:meiHead/m:workDesc/m:work/m:expressionList/m:expression)&gt;1]">
		<xf:select1 ref="m:relationList/m:relation[@rel='isEmbodimentOf'][1]" xxf:refresh-items="true" id="cast-select">
			<xf:label class="fixed_width">Represents: 
				<h:a class="help">?<h:span class="comment">Indicates which version of the work 
					is embodied by the source</h:span></h:a>
			</xf:label>
			<xf:item>
				<xf:label>- Please select -</xf:label>
				<xf:value/>
			</xf:item>
			<xf:itemset nodeset="instance('data-instance')/m:meiHead/m:workDesc/m:work/m:expressionList/m:expression">
				<xf:label><xf:output value="m:titleStmt/m:title"/> (ID: <xf:output value="@xml:id"/>)</xf:label>
				<xf:value ref="@xml:id"></xf:value>
			</xf:itemset>
		</xf:select1>	
	</xf:group>
	
	<xf:switch>
		<xf:case selected="true()" id="hide_source_details">
			<xf:trigger class="detail_button">
				<xf:label>Show source details</xf:label>
				<xf:toggle case="show_source_details" ev:event="DOMActivate"/>
			</xf:trigger>
		</xf:case>
		
		<xf:case selected="false()" id="show_source_details"> 
			<xf:trigger class="detail_button">
				<xf:label>Hide source details</xf:label>
				<xf:toggle case="hide_source_details" ev:event="DOMActivate"/>
			</xf:trigger>
			<h:br clear="all" style="margin-bottom:10px;"/>
			
			<xi:include href="includes/classification-editor.xml" parse="xml"/>
			
			<xf:group ref="m:titleStmt/m:respStmt" id="repeat-source-respstmt">
				<h:fieldset>
					<h:legend>Contributors <h:a class="help">?<h:span class="comment">Lists persons other than the composer or a scribe, 
						contributing to the intellectual contents of this source, e.g. an arranger or editor; 
						the composer is usually specified under "Identification" and need not be specified here.
						Scribes are identified below under "List of hands".</h:span></h:a></h:legend>
					<xf:repeat nodeset="m:persName" id="repeat-source-respstmt-person">
						<dcm:relator ref="."/>
						<dcm:element-buttons 
							triggers="add delete" 
							nodeset="m:persName" 
							index="repeat-source-respstmt-person"
							origin="instance('empty-instance')/m:meiHead/m:workDesc/m:work/m:titleStmt/m:respStmt/m:persName[1]"/>
						<h:br/>
					</xf:repeat>
				</h:fieldset>
			</xf:group>
			<xf:group ref="m:notesStmt">
				<h:fieldset>
					<h:legend>General source description  <h:a class="help">?<h:span class="comment">Text 
						describing or introducing to the source, its history, its significance etc.<br/>
						Information on the source's physical appearance and condition should be given in the 
						"physical description" area below.
					</h:span></h:a> 
						<h:a class="help_plain"><h:img src="http:/editor/images/html_markup.gif" alt="HTML markup allowed"/><h:span class="comment">HTML markup and special characters allowed</h:span></h:a></h:legend>
					<xf:textarea ref="m:annot[@type='source_description']">
					</xf:textarea>
					<xf:group ref="m:annot[@type='links']">
						<h:span class="blocklabel">External source descriptions <h:a class="help">?<h:span class="comment">Links to external resources (texts) about 
							this particular source.</h:span></h:a>
						</h:span>
						<xf:repeat nodeset="m:ptr" id="source-notesstmt-annot-repeat-extptr">
							<h:div>
								<xf:input ref="@target" class="long">
									<xf:label>URI <h:a class="help">?<h:span class="comment">Link to the
										resource, e.g. "http://example.com/source_description.pdf"</h:span></h:a>
									</xf:label>
								</xf:input>
								<xf:input ref="@xl:title">
									<xf:label>Label <h:a class="help">?<h:span class="comment">A short, 
										descriptive text which may serve
										as the link text, e.g. "The Carl Nielsen Edition's source description"</h:span></h:a></xf:label>
								</xf:input>
								<dcm:element-buttons 
									triggers="all" 
									nodeset="m:ptr" 
									index="source-notesstmt-annot-repeat-extptr"
									origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:notesStmt/m:annot[@type='links']/m:ptr"/>
								<!--<dcm:attribute-editor ref=".[instance('conf')/dcm:attr='true']"/>-->
							</h:div>
						</xf:repeat>
					</xf:group>
				</h:fieldset>
			</xf:group>
			
			
			<xf:group ref="m:physDesc">
				<h:fieldset>
					<h:legend>Title page 
						<h:a class="help">?<h:span class="comment">Transcription of the source's title page. Multiple title pages
							may be added if necessary</h:span></h:a>
						<h:a class="help_plain"><h:img src="http:/editor/images/html_markup.gif" alt="HTML markup allowed"/><h:span class="comment">HTML markup and special characters allowed</h:span></h:a>
					</h:legend>
					<xf:repeat nodeset="m:titlePage" id="physdesc-titlepage">
						<xf:input ref="@label">
							<xf:label>Label 
								<h:a class="help">?<h:span class="comment">Optional label overriding the default "Title page" label, 
									e.g. "Secondary title page" or "title page after first fly leaf". 
									Especially, a label should be given to if more than one title page is quoted.</h:span></h:a>
							</xf:label>
						</xf:input>
						<dcm:element-buttons 
							triggers="all" 
							nodeset="m:titlePage" 
							index="physdesc-titlepage"
							origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:titlePage"/>
						<h:br/>
						<xf:textarea ref="m:p" class="mediumheight"/>
						<h:hr/> 
					</xf:repeat>
				</h:fieldset>

				<h:fieldset>
					<h:legend>Physical description 
						<h:a class="help">?<h:span class="comment">Describes features shared by all copies of this source. <h:br/>
							For details on a specific item (a specific copy, or a manuscript), use the "Items" section below.</h:span></h:a>
					</h:legend>
					<xf:repeat nodeset="m:extent" id="physdesc-extent">
						<h:div>
							<h:span class="fixed_width">Extent:</h:span>
							<xf:input ref=".">
								<xf:label>Value <h:a class="help">?<h:span class="comment">The number of pages or folios, e.g. "48", "12 + 236", "XII + 36"
									+ VIII"</h:span></h:a></xf:label>
							</xf:input>
							<xf:input ref="@unit">
								<xf:label>Unit <h:a class="help">?<h:span class="comment">Usually "pages" or "folios"</h:span></h:a></xf:label>
							</xf:input>
							<dcm:element-buttons 
								triggers="delete" 
								nodeset="m:extent" 
								index="physdesc-extent"
								origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:extent"/>
						</h:div>
					</xf:repeat>
					<xf:repeat nodeset="m:dimensions" id="physdesc-dimensions">
						<h:div>
							<h:span class="fixed_width">Dimensions:</h:span>
							<xf:input ref=".">
								<xf:label>Value <h:a class="help">?<h:span class="comment">Numbers describing the physical dimensions of the source given as height x width, e.g.
									"23.5x34"</h:span></h:a></xf:label>
							</xf:input>
							<xf:input ref="@unit">
								<xf:label>Unit <h:a class="help">?<h:span class="comment">Unit of measurement, usually "cm"</h:span></h:a></xf:label>
							</xf:input>
							<dcm:element-buttons 
								triggers="delete" 
								nodeset="m:dimensions" 
								index="physdesc-dimensions"
								origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:physDesc/m:dimensions"/>
						</h:div>
					</xf:repeat>
					<xf:textarea ref="m:physMedium" class="mediumheight">
						<xf:label class="blocklabel">Physical medium <h:a class="help">?<h:span class="comment">Description of 
							paper, number of staves on page, printing technique etc.
							</h:span></h:a></xf:label>
					</xf:textarea>
				</h:fieldset>
			</xf:group>
			
			
			<h:fieldset>
				<h:legend>Publication or creation 
				<h:a class="help">?<h:span class="comment">If the source is a manuscript, date and place of 
					its creation here may be entered.<h:br/>
					Otherwise enter publication data.
				</h:span></h:a></h:legend>
				<xf:repeat nodeset="m:pubStmt" id="repeat-source-publication">
					<h:div>
						<xf:input ref="m:respStmt/m:corpName" class="mediumlong">
							<xf:label class="fixed_width">Publisher </xf:label>
						</xf:input>
					</h:div>
					<h:div>
						<xf:input ref="m:geogName" class="mediumlong">
							<xf:label class="fixed_width">Place </xf:label>
						</xf:input>
					</h:div>
					<dcm:date-editor ref="m:date">
						<xf:label class="fixed_width">Date 
						<h:a class="help">?<h:span class="comment">This field may be used for manuscript datings also.</h:span></h:a>
						</xf:label>
						</dcm:date-editor>
					<h:div>
						<xf:input ref="m:identifier[@type='plate_no']" class="mediumlong">
							<xf:label class="fixed_width">Plate no. </xf:label>
						</xf:input>
						<dcm:element-buttons 
							triggers="delete" 
							nodeset="m:pubstmt" 
							index="repeat-source-publication"
							origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:pubStmt"/>
					</h:div>
					<xf:group ref="m:identifier[@analog='RISM']">
						<xf:input ref="." class="mediumlong">
							<xf:label class="fixed_width">RISM no. <h:a class="help">?<h:span class="comment">Use with  
							prints only. With manuscripts, the RISM identifier should be given as part of a 
							specific item's location information (below).</h:span></h:a></xf:label>
						</xf:input>
						<h:br clear="all"/>
					</xf:group>
				</xf:repeat>
				<!-- repeat-source-publication -->
			</h:fieldset>
			
			<h:fieldset class="items">
				<h:legend class="items">Items
					<h:a class="help">?<h:span class="comment">A list of individual copies of the source. 
						Manuscript sources will only have one such item.<h:br/>
						If the item consists of several components with different physical appearance, 
						the distinct features of each component may be specified using the item's "Components" section.<h:br/>
					</h:span></h:a></h:legend>
				<xf:repeat nodeset="m:itemList/m:item" id="repeat-item">
					<h:fieldset>
						<h:legend>Item <dcm:id/> 
							<dcm:element-buttons 
								triggers="all" 
								nodeset="m:item" 
								index="repeat-item"
								origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:itemList/m:item[1]"/>
						</h:legend>
						<dcm:item ref="."/>
						<h:fieldset class="item-components">
							<h:legend class="item-components">Components <h:a class="help">?<h:span class="comment">Descriptions of the individual parts that 
								constitute a composite source</h:span></h:a></h:legend>
							<xf:repeat nodeset="m:componentGrp/m:item" id="repeat-item-component">
								<h:fieldset>
									<h:legend>Component <dcm:id/> 
										<dcm:element-buttons 
											triggers="all" 
											nodeset="m:item" 
											index="repeat-item-component"
											origin="instance('empty-instance')/m:meiHead/m:fileDesc/m:sourceDesc/m:source/m:itemList/m:item[1]/m:componentGrp/m:item[1]"/>
									</h:legend>
									<dcm:item ref="."/>
								</h:fieldset>
							</xf:repeat>
						</h:fieldset>
					</h:fieldset>
				</xf:repeat>
			</h:fieldset>
			
		</xf:case>
	</xf:switch>
	
	
</h:fieldset>
